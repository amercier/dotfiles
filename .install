#!/usr/bin/env bash --login

# Bash configuration
# ==================

. "$HOME/.profile.d/colors"

version() {
  ("$bin" --version 2>/dev/null || "$bin" -v) | egrep -o '[0-9]+(\.[0-9]+)+'
}

# Run all scripts for which the command doesn't exist and no function exist
while read path; do
  [ -x "$path" ] || continue
  bin=$(basename "$path" | egrep -o '[^\.]+$')
  if which "$bin" > /dev/null || [ "$(type -t "$bin")" == "function" ]; then
    echo -e "$(green ✔) $(cyan "$bin") is already installed ($(yellow "v$(version "$bin")"))"
  else
    echo "Installing $(cyan "$bin")... "
    "$path" \
      && echo "$(green ✔) $(cyan "$bin") $(green installed successfully) ($(yellow "v$(version "$bin")"))" \
      || echo "$(red ✘ Failed installing) $(red_light "$bin")"
  fi
done < <(find "$HOME/.install.d" -type f)

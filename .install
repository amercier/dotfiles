#!/usr/bin/bash --login

# Bash configuration
# ==================

. "$HOME/.profile.d/.colors"

version() {
  ("$bin" --version || "$bin" -v) 2>&1 | egrep -o '[0-9]+(\.[0-9]+)+'
}

# Run all scripts for which the command doesn't exist and no function exist
while read path; do
  [ -x "$path" ] || continue
  bin=$(basename "$path" | egrep -o '[^\.]+$')
  if which "$bin" > /dev/null || [ "$(type -t "$bin")" == "function" ]; then
    echo -e "$(green ✔) $(cyan "$bin") is already installed ($(yellow "v$(version "$bin")"))"
  else
    echo "Installing $(cyan "$bin")... "
    . "$path"
    ok=$?
    version=$(version "$bin")
    if [ "$version" = '' ]; then
      [ $ok = 0 ] \
      && echo "$(green ✔) $(cyan "$bin") $(green configured successfully)" \
      || echo "$(red ✘ Failed configuring) $(red_light "$bin")"
    else
      [ $ok = 0 ] \
      && echo "$(green ✔) $(cyan "$bin") $(green installed successfully) ($(yellow "v$version"))" \
      || echo "$(red ✘ Failed installing) $(red_light "$bin")"
    fi
  fi
done < <(find "$HOME/.install.d" -type f ! -name '.*')
